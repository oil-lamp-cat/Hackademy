# í’€ì–´ë´…ì‹œë‹¤ : DreamHack : Cookie

<aside>
ğŸ’¡ author : ê¹€ê°€ì€(circleolami) 2023-01-25

</aside>

ì§€ê¸ˆê¹Œì§€ ë°°ìš´ ê°œë…ì„ ì´ìš©í•œ ë¬¸ì œë¥¼ í’€ì–´ë´…ì‹œë‹¤

## í•´í‚¹ëŒ€íšŒ

ì‹¤ì œ ì‚¬ì´íŠ¸ì— í•´í‚¹ì„ í•´ë³´ëŠ” ê²ƒì€ í˜„í–‰ë²•ìƒ ë¶ˆë²•ì…ë‹ˆë‹¤.

![Untitled](Untitled%20456.png)

ê·¸ëŸ¬ë‚˜ ì •ë³´ ë³´ì•ˆì„ ê³µë¶€í•˜ëŠ” ì‚¬ëŒì„ ìœ„í•´ (ë¸”ë™í–‡ë“¤ë„ ì¶œì „í•˜ì§€ë§Œ) í•´í‚¹ê¸°ìˆ ì„ ì—°ìŠµí•  ìˆ˜ ìˆë„ë¡ ë¬¸ì œí’€ì´ í˜•ì‹ì˜ í•´í‚¹ ëŒ€íšŒë¼ëŠ” ê²ƒì´ ì¡´ì¬í•©ë‹ˆë‹¤.

# CTF (Capture The Flag)

CTF ëŠ” í•´í‚¹ ëŒ€íšŒì˜ í˜•ì‹ ì¤‘ ê°€ì¥ ë„ë¦¬ ì“°ì´ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

CTF ëŠ” Capture The Flag (ê¹ƒë°œ ëºê¸°)ì˜ ì•½ìì¸ë°, 

ì—¬ê¸°ì„œ ê¹ƒë°œ(Flag)ì€ ë¬¸ì œì— ìˆ¨ê²¨ì§„ ëœë¤ë¬¸ìì—´ì„ ë§í•©ë‹ˆë‹¤.

ë¬¸ì œ ì¶œì œìëŠ” ì´ Flagë¥¼ ë³´ì•ˆ ì‹œìŠ¤í…œ ì•ˆì— ìˆ¨ê²¨ë†“ìŠµë‹ˆë‹¤.

í•´ì»¤ëŠ” ë³´ì•ˆ ì‹œìŠ¤í…œì„ í•´í‚¹í•´ì„œ, ì´ ê¹ƒë°œì„ ì–»ì–´ë‚´ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

í•œë²ˆ, ì‹¤ì œ CTF ë¬¸ì œë¥¼ í’€ì–´ë³´ë©´ì„œ, í•´í‚¹ ëŒ€íšŒì— ëŒ€í•´ ë°°ì›Œë´…ì‹œë‹¤.

ìš°ë¦¬ê°€ ë°°ìš´ Cookie ëŠ” í•´í‚¹ ëŒ€íšŒì˜ ë‹¨ê³¨ ì£¼ì œ ì¤‘ í•˜ë‚˜ ì…ë‹ˆë‹¤.

(ì—­ì‚¬ìƒ Cookie í•´í‚¹ì´ ë§ì´ ì´ë£¨ì–´ì¡Œê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í•´í‚¹ ëŒ€íšŒëŠ” ì‹¤ì œ í•´í‚¹ ì‚¬ë¡€ë¥¼ ë°˜ì˜í•˜ê±°ë“ ìš”)

## ë“œë¦¼í•µ ê°€ì…

ìš°ì„  ë“œë¦¼í•µì— ê°€ì…í•©ë‹ˆë‹¤. 

![2.png](2%201.png)

## ì›Œê²Œì„

ë“œë¦¼í•µ í™ˆí˜ì´ì§€ì—ì„œ ì›Œê²Œì„ì„ í´ë¦­í•©ë‹ˆë‹¤. 

![1.png](1%202.png)

â€œì´ˆë³´ìë¥¼ ìœ„í•œ ì…ë¬¸ìš© ë¬¸ì œâ€ ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

![2.png](2%202.png)

ì…ë¬¸ìš© ë¬¸ì œì—ì„œ cookieë¥¼ í´ë¦­í•©ë‹ˆë‹¤. cookie ì´ì™¸ì—ë„ ì—¬ëŸ¬ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![3.png](3.png)

## Cookie

ì´ ë¬¸ì œëŠ” ì¿ í‚¤ë¡œ ì¸ì¦ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë¡œê·¸ì¸ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

![1.png](1%203.png)

![Untitled](Untitled%20457.png)

ì´ ê³³ì— Flag ë¥¼ ì œì¶œí•˜ë©´, í•´í‚¹ì„ ì„±ê³µí•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

ì„œë²„ ìƒì„±í•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´, ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì„ì‹œì„œë²„ê°€ ìƒì„±ë©ë‹ˆë‹¤. 

![Untitled](Untitled%20458.png)

ì ‘ì† ë§í¬ë¡œ ë“¤ì–´ê°€ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì„ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì´ê±´ ìš°ë¦¬ê°€ ê³ ì–‘ì´ í™ˆí˜ì´ì§€ë¥¼ ë§Œë“¤ì—ˆë˜ ê²ƒ ì²˜ëŸ¼, ë¬¸ì œ ì¶œì œìê°€ ì„¤ê³„í•œ ë³´ì•ˆ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

ì´ ê³³ ì–´ë”˜ê°€ì—, Flag(ê¹ƒë°œ)ì´ ìˆ¨ê²¨ì ¸ìˆê³ , ê·¸ê²ƒì„ ì°¾ì•„ë‚´ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

![1.png](1%204.png)

# ë¬¸ì œ íŒŒì¼ í™•ì¸í•˜ê¸°

ìš°ë¦¬ê°€ ì–´ë–¤ ì‹œìŠ¤í…œì„ í•´í‚¹í•  ë•Œ, ê·¸ ì‹œìŠ¤í…œì€ ë³´í†µ ì½”ë”©ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ìˆì„ ê²ƒ ì…ë‹ˆë‹¤.

ë³´í†µ ì½”ë“œëŠ” ê°œë°œìë§Œ ì•Œê³  ìˆê³ , ì‚¬ìš©í•˜ëŠ” ìœ ì €ëŠ” ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì½”ë“œë¥¼ ëª¨ë¥´ëŠ” ìƒíƒœì—ì„œ í•´í‚¹ì„ í•˜ëŠ” ê²ƒì€ ë„ˆë¬´ ì–´ë ¤ìš°ë¯€ë¡œ, ì‰¬ìš´ í•´í‚¹ ëŒ€íšŒ ë¬¸ì œì—ì„œëŠ” ì‹œìŠ¤í…œì˜ ì½”ë“œë¥¼ ì¤ë‹ˆë‹¤. (ì•ˆì£¼ëŠ” ë¬¸ì œë„ ìˆìŠµë‹ˆë‹¤)

![Untitled](Untitled%20459.png)

ë¬¸ì œ íŒŒì¼ì„ í™•ì¸í•´ë´…ì‹œë‹¤. 

# ì½”ë“œ ë¶„ì„í•˜ê¸°

ì´ê²ƒì€ flask ë¼ëŠ” ê²ƒìœ¼ë¡œ ë§Œë“  ì›¹í˜ì´ì§€ ì…ë‹ˆë‹¤.

ë¬¸ë²•ì€ ë‹¤ë¥´ì§€ë§Œ, ì›¹ì€ í•µì‹¬ ê¸°ëŠ¥ì€ ë­˜ë¡œ ë§Œë“¤ê±´ ë‹¤ ë¹„ìŠ·í•©ë‹ˆë‹¤.

```python
#!/usr/bin/python3
from flask import Flask, request, render_template, make_response, redirect, url_for

app = Flask(__name__)

try:
    FLAG = open('./flag.txt', 'r').read()
except:
    FLAG = '[**FLAG**]'

users = {
    'guest': 'guest',
    'admin': FLAG
}

@app.route('/')
def index():
    username = request.cookies.get('username', None)
    if username:
        return render_template('index.html', text=f'Hello {username}, {"flag is " + FLAG if username == "admin" else "you are not admin"}')
    return render_template('index.html')

@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'GET':
        return render_template('login.html')
    elif request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        try:
            pw = users[username]
        except:
            return '<script>alert("not found user");history.go(-1);</script>'
        if pw == password:
            resp = make_response(redirect(url_for('index')) )
            resp.set_cookie('username', username)
            return resp 
        return '<script>alert("wrong password");history.go(-1);</script>'

app.run(host='0.0.0.0', port=8000)
```

# ë¬¸ì œê°€ ìš”êµ¬í•˜ëŠ” FLAG ê°€ ì–´ëŠ ê²ƒì¸ì§€ ì°¾ê¸°

ì´ ì½”ë“œëŠ” ì„œë²„ì—ì„œ ì‘ë™í•˜ëŠ” ë°±ì•¤ë“œ ì½”ë“œì…ë‹ˆë‹¤.

ì´ ë¶€ë¶„ì„ ë³´ë©´, íŒŒì´ì¬ì˜ open() í•¨ìˆ˜ë¡œ ë¡œì»¬ì— ìˆëŠ” íŒŒì¼ì„ ì½ìŠµë‹ˆë‹¤. ì´ê²ƒì€ ì„œë²„ì— ì €ì¥ë˜ì–´ìˆìŠµë‹ˆë‹¤.

./flag.txt ê°€ ìš°ë¦¬ê°€ ì›í•˜ëŠ” flag ì¸ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

ì„œë²„ì— ì €ì¥ë˜ì–´ìˆìœ¼ë¯€ë¡œ í•´ì»¤ì¸ ìš°ë¦¬ëŠ” ì½ì„ ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤ë§Œ,

ì´ ì½í˜€ì§„ ë¬¸ìì—´ì´ FLAG ë¼ëŠ” ë³€ìˆ˜ì— ì €ì¥ë˜ë¯€ë¡œ, ì´ FLAG ê°’ì„ ìœ ì¶œí•´ì„œ ê°„ì ‘ì ìœ¼ë¡œ flag ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

```python
try:
    FLAG = open('./flag.txt', 'r').read()
except:
    FLAG = '[**FLAG**]'
```

ê³ ì–‘ì´ í™ˆí˜ì´ì§€ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, pw ì™€ password ê°€ ê°™ì€ì§€ ê²€ì‚¬í•˜ëŠ” ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ì‹œìŠ¤í…œì¸ ê²ƒì´ì£ .

ì´ë•Œ, password ëŠ” ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, request.form ì¦‰ ì‚¬ìš©ìê°€ í¼ì— ì…ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œì…ë‹ˆë‹¤.

```python
password = request.form.get('password')
...ì¤‘ëµ...
        if pw == password:
            resp = make_response(redirect(url_for('index')) )
            resp.set_cookie('username', username)
            return resp 
```

ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë³´ë©´, guestì˜ íŒ¨ìŠ¤ì›Œë“œëŠ” guestì´ê³ 

adminì˜ íŒ¨ìŠ¤ì›Œë“œëŠ” FLAGì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

adminì˜ íŒ¨ìŠ¤ì›Œë“œëŠ” FLAG ì´ë¯€ë¡œ ìš°ë¦¬ê°€ ì•Œ ìˆ˜ ìˆëŠ” ê°’ì´ ì•„ë‹™ë‹ˆë‹¤. ë”°ë¼ì„œ adminì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì„œ ì •ìƒì ì¸ ë°©ë²•ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•´ë³´ì…ë‹ˆë‹¤.

render_template ëŠ” í™”ë©´ì— íŒŒì´ì¬ ë³€ìˆ˜ë¥¼ html ë¡œ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

ì•„ë˜ë¥¼ ë³´ë©´, admin ìœ¼ë¡œ ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ì›¹ì‚¬ì´íŠ¸ê°€ FLAG ë¥¼ ì¶œë ¥í•´ì¤ë‹ˆë‹¤.

ì´ê²ƒì„ ë³´ê³ , í•´í‚¹ê³µê²©ì„ í†µí•´ adminìœ¼ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ê²ƒì´ ë¬¸ì œì˜ë„ì„ì„ ì¶”ì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
@app.route('/')
def index():
    username = request.cookies.get('username', None)
    if username:
        return render_template('index.html', text=f'Hello {username}, {"flag is " + FLAG if username == "admin" else "you are not admin"}')
    return render_template('index.html')
```

guestë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ adminì´ ì•„ë‹ˆë¼ëŠ” ë¬¸êµ¬ê°€ ëœ¹ë‹ˆë‹¤. 

![2.png](2%203.png)

cookie ì •ë³´ë¥¼ í™•ì¸í•´ ë´…ì‹œë‹¤. 

cookie ì •ë³´ëŠ” ë§ˆìš°ìŠ¤ ìš°í´ë¦­ > ê²€ì‚¬ > Application > Cookiesìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![3.png](3%201.png)

# Cookie Poisoning Attack

ë¡œê·¸ì¸ ì‹œìŠ¤í…œì˜ ì·¨ì•½ì ì€ ì—¬ê¸°ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.

```python
@app.route('/')
def index():
    username = request.cookies.get('username', None)
    if username:
        return render_template('index.html', text=f'Hello {username}, {"flag is " + FLAG if username == "admin" else "you are not admin"}')
    return render_template('index.html')
```

username ì´ admin ì´ê¸°ë§Œ í•˜ë©´ flag is FLAG ë¡œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” í”Œë˜ê·¸ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
{"flag is " + FLAG if username == "admin" else "you are not admin"}')
```

ì—¬ê¸°ì„œ username ì€ ì¿ í‚¤ì´ë¯€ë¡œ, í´ë¼ì´ì–¸íŠ¸-ì‚¬ì´ë“œì—ì„œ ì–¼ë§ˆë“ ì§€ ë³€ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (Client-side Cookie Poisoning)

usernameì´ guestì…ë‹ˆë‹¤. guestë¥¼ adminìœ¼ë¡œ ë°”ê¿”ë´…ì‹œë‹¤. 

![4.png](4.png)

ìƒˆë¡œê³ ì¹¨ì„ í•˜ë©´ flagë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

![5.png](5.png)

ì´ê²ƒì„ ë³µì‚¬í•´ì„œ, 

ì´ê³³ì— ë¶™ì—¬ë„£ê³  ì œì¶œí•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ ë©ë‹ˆë‹¤.

![Untitled](Untitled%20457.png)

ê·¸ëŸ¬ë©´ í•´í‚¹ì— ì„±ê³µí•©ë‹ˆë‹¤.

ê³„ì†